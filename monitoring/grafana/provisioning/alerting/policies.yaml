# monitoring/grafana/provisioning/alerting/policies.yaml
# Notification routing policies - Discord only
#
# Routes alerts to appropriate contact points based on severity and category
# Docs: https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/

apiVersion: 1

policies:
  - orgId: 1
    # Default receiver when no routes match
    receiver: discord-all

    # Group alerts by these labels
    group_by:
      - alertname
      - severity
      - category

    # Timing settings
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h

    routes:
      # Critical alerts → discord-critical with faster timing
      - receiver: discord-critical
        matchers:
          - severity = critical
        continue: false
        group_wait: 10s
        group_interval: 1m
        repeat_interval: 15m

      # Warning alerts → discord-all
      - receiver: discord-all
        matchers:
          - severity = warning
        continue: false
        group_wait: 1m
        group_interval: 5m
        repeat_interval: 4h

      # Infrastructure category → discord-all (any severity)
      - receiver: discord-all
        matchers:
          - category = infrastructure
        continue: false
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 4h
