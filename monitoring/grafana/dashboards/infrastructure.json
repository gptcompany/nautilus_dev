{
  "uid": "infrastructure-health",
  "title": "Infrastructure Health",
  "description": "Complete infrastructure monitoring: containers, services, ports, system metrics",
  "tags": ["infrastructure", "monitoring", "enterprise", "docker", "prometheus"],
  "timezone": "browser",
  "refresh": "30s",
  "time": {"from": "now-1h", "to": "now"},
  "schemaVersion": 39,
  "templating": {
    "list": [
      {
        "name": "container",
        "type": "query",
        "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
        "query": "label_values(container_last_seen, name)",
        "refresh": 2,
        "multi": true,
        "includeAll": true,
        "allValue": ".*"
      }
    ]
  },
  "panels": [
    {
      "id": 100,
      "title": "System Overview",
      "type": "row",
      "gridPos": {"x": 0, "y": 0, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 1,
      "title": "Containers Running",
      "type": "stat",
      "gridPos": {"x": 0, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [{"expr": "count(container_last_seen{name!=\"\"})", "refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 10},
              {"color": "green", "value": 14}
            ]
          }
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center"}
    },
    {
      "id": 2,
      "title": "System Uptime",
      "type": "stat",
      "gridPos": {"x": 4, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [{"expr": "node_time_seconds - node_boot_time_seconds", "refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "dtdurations",
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "yellow", "value": null},
              {"color": "green", "value": 86400}
            ]
          }
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center"}
    },
    {
      "id": 3,
      "title": "CPU Usage",
      "type": "gauge",
      "gridPos": {"x": 8, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [{"expr": "100 - (avg(irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)", "refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "id": 4,
      "title": "Memory Usage",
      "type": "gauge",
      "gridPos": {"x": 12, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [{"expr": "(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100", "refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 80},
              {"color": "red", "value": 95}
            ]
          }
        }
      }
    },
    {
      "id": 5,
      "title": "Disk Usage /",
      "type": "gauge",
      "gridPos": {"x": 16, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [{"expr": "(1 - node_filesystem_avail_bytes{mountpoint=\"/\"} / node_filesystem_size_bytes{mountpoint=\"/\"}) * 100", "refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 80},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "id": 6,
      "title": "Network I/O",
      "type": "stat",
      "gridPos": {"x": 20, "y": 1, "w": 4, "h": 4},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "sum(rate(node_network_receive_bytes_total{device!~\"lo|veth.*|docker.*|br-.*\"}[5m]))", "legendFormat": "RX", "refId": "A"},
        {"expr": "sum(rate(node_network_transmit_bytes_total{device!~\"lo|veth.*|docker.*|br-.*\"}[5m]))", "legendFormat": "TX", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "Bps"}},
      "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center"}
    },
    {
      "id": 101,
      "title": "Prometheus Targets",
      "type": "row",
      "gridPos": {"x": 0, "y": 5, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 10,
      "title": "Prometheus Targets Status",
      "type": "table",
      "gridPos": {"x": 0, "y": 6, "w": 12, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "up", "format": "table", "instant": true, "refId": "A"}
      ],
      "transformations": [
        {"id": "organize", "options": {"excludeByName": {"Time": true, "__name__": true}, "renameByName": {"job": "Service", "instance": "Endpoint", "Value": "Status"}}}
      ],
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Status"},
            "properties": [
              {"id": "mappings", "value": [
                {"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}}},
                {"type": "value", "options": {"1": {"text": "UP", "color": "green"}}}
              ]},
              {"id": "custom.cellOptions", "value": {"type": "color-background"}}
            ]
          }
        ]
      },
      "options": {"showHeader": true, "footer": {"show": false}}
    },
    {
      "id": 11,
      "title": "Target Scrape Duration",
      "type": "timeseries",
      "gridPos": {"x": 12, "y": 6, "w": 12, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "scrape_duration_seconds", "legendFormat": "{{job}}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {"drawStyle": "line", "fillOpacity": 20, "lineWidth": 2}
        }
      }
    },
    {
      "id": 102,
      "title": "Docker Containers",
      "type": "row",
      "gridPos": {"x": 0, "y": 12, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 20,
      "title": "Container CPU Usage",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 13, "w": 12, "h": 8},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "rate(container_cpu_usage_seconds_total{name=~\"$container\", name!=\"\"}[5m]) * 100", "legendFormat": "{{name}}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "custom": {"drawStyle": "line", "fillOpacity": 20, "lineWidth": 1, "spanNulls": true}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max"]}}
    },
    {
      "id": 21,
      "title": "Container Memory Usage",
      "type": "timeseries",
      "gridPos": {"x": 12, "y": 13, "w": 12, "h": 8},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "container_memory_usage_bytes{name=~\"$container\", name!=\"\"}", "legendFormat": "{{name}}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "custom": {"drawStyle": "line", "fillOpacity": 20, "lineWidth": 1, "spanNulls": true}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max"]}}
    },
    {
      "id": 22,
      "title": "Container Network I/O",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 21, "w": 12, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "rate(container_network_receive_bytes_total{name=~\"$container\", name!=\"\"}[5m])", "legendFormat": "{{name}} RX", "refId": "A"},
        {"expr": "-rate(container_network_transmit_bytes_total{name=~\"$container\", name!=\"\"}[5m])", "legendFormat": "{{name}} TX", "refId": "B"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "Bps",
          "custom": {"drawStyle": "line", "fillOpacity": 20}
        }
      }
    },
    {
      "id": 23,
      "title": "Container Filesystem I/O",
      "type": "timeseries",
      "gridPos": {"x": 12, "y": 21, "w": 12, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "rate(container_fs_reads_bytes_total{name=~\"$container\", name!=\"\"}[5m])", "legendFormat": "{{name}} reads", "refId": "A"},
        {"expr": "-rate(container_fs_writes_bytes_total{name=~\"$container\", name!=\"\"}[5m])", "legendFormat": "{{name}} writes", "refId": "B"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "Bps",
          "custom": {"drawStyle": "line", "fillOpacity": 20}
        }
      }
    },
    {
      "id": 103,
      "title": "System Resources",
      "type": "row",
      "gridPos": {"x": 0, "y": 27, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 30,
      "title": "CPU Usage by Mode",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 28, "w": 8, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "sum(rate(node_cpu_seconds_total{mode!=\"idle\"}[5m])) by (mode) * 100", "legendFormat": "{{mode}}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "custom": {"drawStyle": "line", "fillOpacity": 40, "stacking": {"mode": "normal"}}
        }
      }
    },
    {
      "id": 31,
      "title": "Memory Breakdown",
      "type": "timeseries",
      "gridPos": {"x": 8, "y": 28, "w": 8, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes", "legendFormat": "Used", "refId": "A"},
        {"expr": "node_memory_Cached_bytes", "legendFormat": "Cached", "refId": "B"},
        {"expr": "node_memory_Buffers_bytes", "legendFormat": "Buffers", "refId": "C"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "custom": {"drawStyle": "line", "fillOpacity": 20}
        }
      }
    },
    {
      "id": 32,
      "title": "Disk Space by Mount",
      "type": "bargauge",
      "gridPos": {"x": 16, "y": 28, "w": 8, "h": 6},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "(1 - node_filesystem_avail_bytes{fstype!~\"tmpfs|overlay\"} / node_filesystem_size_bytes{fstype!~\"tmpfs|overlay\"}) * 100", "legendFormat": "{{mountpoint}}", "refId": "A", "instant": true}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      },
      "options": {"orientation": "horizontal", "displayMode": "gradient"}
    },
    {
      "id": 104,
      "title": "Container Details",
      "type": "row",
      "gridPos": {"x": 0, "y": 34, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 40,
      "title": "Container Status",
      "type": "table",
      "gridPos": {"x": 0, "y": 35, "w": 24, "h": 8},
      "datasource": {"type": "prometheus", "uid": "dez5wyaa618n4e"},
      "targets": [
        {"expr": "container_last_seen{name!=\"\"}", "format": "table", "instant": true, "refId": "A"}
      ],
      "transformations": [
        {"id": "organize", "options": {
          "excludeByName": {"Time": true, "Value": true, "__name__": true, "id": true, "image": true},
          "renameByName": {"name": "Container", "instance": "Host"}
        }},
        {"id": "sortBy", "options": {"fields": {}, "sort": [{"field": "Container", "desc": false}]}}
      ],
      "fieldConfig": {
        "overrides": [
          {"matcher": {"id": "byName", "options": "Container"}, "properties": [{"id": "custom.width", "value": 250}]}
        ]
      },
      "options": {"showHeader": true, "footer": {"show": true, "reducer": ["count"]}}
    }
  ]
}
